<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ASP.NET Core: JWT and Refresh Token with HttpOnly Cookies | Alim Özdemir</title>
    <meta name="description" content="I would like to talk about the SPA client authentication. Most of the blog implementations are stores the token into localStorage, sessionStorage or in-memory storage (redux/vuex/ngrx). It depends on your needs.  For instance, you don't need high security with your In-House applications. For other cases, you need to increase your security. Today, I will try to explain that with my best.">
    <meta name="generator" content="VitePress v1.5.0">
    <link rel="preload stylesheet" href="/assets/style.-ZQ2zhvB.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.Dat-I3Zf.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.Dm_onezB.js">
    <link rel="modulepreload" href="/assets/chunks/framework.Ao2Tp7LI.js">
    <link rel="modulepreload" href="/assets/posts_aspnet-core-jwt-and-refresh-token-with-httponly-cookies.md.BpEQeSYu.lean.js">
    <script src="https://www.googletagmanager.com/gtag/js?id=G-N7367JX5TN" async></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-N7367JX5TN");</script>
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
    <meta property="og:title" content="ASP.NET Core: JWT and Refresh Token with HttpOnly Cookies | Alim Özdemir">
    <meta property="og:description" content="I would like to talk about the SPA client authentication. Most of the blog implementations are stores the token into localStorage, sessionStorage or in-memory storage (redux/vuex/ngrx). It depends on your needs.  For instance, you don't need high security with your In-House applications. For other cases, you need to increase your security. Today, I will try to explain that with my best.">
    <meta property="og:url" content="https://www.alimozdemir.com/posts/aspnet-core-jwt-and-refresh-token-with-httponly-cookies">
    <meta property="og:image" content="/img/cookie_monster.jpg">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="ASP.NET Core: JWT and Refresh Token with HttpOnly Cookies | Alim Özdemir">
    <meta name="twitter:description" content="I would like to talk about the SPA client authentication. Most of the blog implementations are stores the token into localStorage, sessionStorage or in-memory storage (redux/vuex/ngrx). It depends on your needs.  For instance, you don't need high security with your In-House applications. For other cases, you need to increase your security. Today, I will try to explain that with my best.">
    <meta name="twitter:url" content="https://www.alimozdemir.com/posts/aspnet-core-jwt-and-refresh-token-with-httponly-cookies">
    <meta name="twitter:image" content="/img/cookie_monster.jpg">
    <meta name="twitter:site" content="@almozdmr">
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-59c4430d><!--[--><!--]--><!--[--><span tabindex="-1" data-v-ecd1bc0b></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-ecd1bc0b> Skip to content </a><!--]--><!----><header class="VPNav" data-v-59c4430d data-v-930260ff><div class="VPNavBar" data-v-930260ff data-v-29871249><div class="wrapper" data-v-29871249><div class="container" data-v-29871249><div class="title" data-v-29871249><div class="VPNavBarTitle" data-v-29871249 data-v-f2a17b43><a class="title" href="/" data-v-f2a17b43><!--[--><!--]--><!----><span data-v-f2a17b43>Alim Özdemir</span><!--[--><!--[--><!--[--><!--[--><!--[--><!----><img id="avatar" class="w-10" alt="Profile Photo" src="/avatar/avatar.png"><span class="name-title pl-4">Alim Özdemir</span><span class="post-title pl-4 hidden">ASP.NET Core: JWT and Refresh Token with HttpOnly Cookies</span><!--]--><!--]--><!--]--><!--]--><!--]--></a></div></div><div class="content" data-v-29871249><div class="content-body" data-v-29871249><!--[--><!--]--><div class="VPNavBarSearch search" data-v-29871249><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-29871249 data-v-17d0a7e7><span id="main-nav-aria-label" class="visually-hidden" data-v-17d0a7e7> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-17d0a7e7 data-v-24c50f4c><!--[--><span data-v-24c50f4c>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/about" tabindex="0" data-v-17d0a7e7 data-v-24c50f4c><!--[--><span data-v-24c50f4c>About</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-29871249 data-v-86871e5f><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-86871e5f data-v-76c55e31 data-v-ce98919f><span class="check" data-v-ce98919f><span class="icon" data-v-ce98919f><!--[--><span class="vpi-sun sun" data-v-76c55e31></span><span class="vpi-moon moon" data-v-76c55e31></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-29871249 data-v-2b070e2c data-v-4ffd68fd><!--[--><a class="VPSocialLink no-icon" href="https://www.github.com/alimozdemir" aria-label="github" target="_blank" rel="noopener" data-v-4ffd68fd data-v-7020546b><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="https://www.linkedin.com/in/almozdmr/" aria-label="linkedin" target="_blank" rel="noopener" data-v-4ffd68fd data-v-7020546b><span class="vpi-social-linkedin"></span></a><a class="VPSocialLink no-icon" href="https://www.twitter.com/almozdmr" aria-label="twitter" target="_blank" rel="noopener" data-v-4ffd68fd data-v-7020546b><span class="vpi-social-twitter"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-29871249 data-v-681aea7d data-v-3246d379><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-3246d379><span class="vpi-more-horizontal icon" data-v-3246d379></span></button><div class="menu" data-v-3246d379><div class="VPMenu" data-v-3246d379 data-v-1f92d73c><!----><!--[--><!--[--><!----><div class="group" data-v-681aea7d><div class="item appearance" data-v-681aea7d><p class="label" data-v-681aea7d>Appearance</p><div class="appearance-action" data-v-681aea7d><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-681aea7d data-v-76c55e31 data-v-ce98919f><span class="check" data-v-ce98919f><span class="icon" data-v-ce98919f><!--[--><span class="vpi-sun sun" data-v-76c55e31></span><span class="vpi-moon moon" data-v-76c55e31></span><!--]--></span></span></button></div></div></div><div class="group" data-v-681aea7d><div class="item social-links" data-v-681aea7d><div class="VPSocialLinks social-links-list" data-v-681aea7d data-v-4ffd68fd><!--[--><a class="VPSocialLink no-icon" href="https://www.github.com/alimozdemir" aria-label="github" target="_blank" rel="noopener" data-v-4ffd68fd data-v-7020546b><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="https://www.linkedin.com/in/almozdmr/" aria-label="linkedin" target="_blank" rel="noopener" data-v-4ffd68fd data-v-7020546b><span class="vpi-social-linkedin"></span></a><a class="VPSocialLink no-icon" href="https://www.twitter.com/almozdmr" aria-label="twitter" target="_blank" rel="noopener" data-v-4ffd68fd data-v-7020546b><span class="vpi-social-twitter"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-29871249 data-v-cd66bde9><span class="container" data-v-cd66bde9><span class="top" data-v-cd66bde9></span><span class="middle" data-v-cd66bde9></span><span class="bottom" data-v-cd66bde9></span></span></button></div></div></div></div><div class="divider" data-v-29871249><div class="divider-line" data-v-29871249></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-59c4430d data-v-10c35203><div class="container" data-v-10c35203><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-10c35203 data-v-8f23d1a3><button data-v-8f23d1a3>Return to top</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-59c4430d data-v-6e3945fc><div class="VPDoc has-aside" data-v-6e3945fc data-v-07acbee8><!--[--><!--[--><!--[--><div class="info-box flex flex-row-reverse items-center justify-between mb-4 xl:flex-col xl:items-start xl:pb-4 xl:hidden" data-v-4e7dc19b><div class="py-4 flex gap-x-2" data-v-4e7dc19b><!--[--><span class="text-sm rounded border p-2" data-v-4e7dc19b>ASP.NET</span><!--]--></div><div data-v-4e7dc19b><span data-v-4e7dc19b>September 13, 2020</span></div></div><!--]--><!--]--><!--]--><div class="container" data-v-07acbee8><div class="aside" data-v-07acbee8><div class="aside-curtain" data-v-07acbee8></div><div class="aside-container" data-v-07acbee8><div class="aside-content" data-v-07acbee8><div class="VPDocAside" data-v-07acbee8 data-v-a8674dc6><!--[--><!--[--><!--[--><!--[--><div class="info-box flex flex-row-reverse items-center justify-between mb-4 xl:flex-col xl:items-start xl:pb-4 hidden xl:flex" data-v-4e7dc19b><div class="py-4 flex gap-x-2" data-v-4e7dc19b><!--[--><span class="text-sm rounded border p-2" data-v-4e7dc19b>ASP.NET</span><!--]--></div><div data-v-4e7dc19b><span data-v-4e7dc19b>September 13, 2020</span></div></div><!--]--><!--]--><!--]--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-a8674dc6 data-v-61e3a742><div class="content" data-v-61e3a742><div class="outline-marker" data-v-61e3a742></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-61e3a742>On this page</div><ul class="VPDocOutlineItem root" data-v-61e3a742 data-v-dcb41878><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-a8674dc6></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-07acbee8><div class="content-container" data-v-07acbee8><!--[--><!--]--><main class="main" data-v-07acbee8><div articleperpage="5" class="vp-doc _posts_aspnet-core-jwt-and-refresh-token-with-httponly-cookies" data-v-07acbee8><div><h1 id="asp-net-core-jwt-and-refresh-token-with-httponly-cookies" tabindex="-1">ASP.NET Core: JWT and Refresh Token with HttpOnly Cookies <a class="header-anchor" href="#asp-net-core-jwt-and-refresh-token-with-httponly-cookies" aria-label="Permalink to &quot;ASP.NET Core: JWT and Refresh Token with HttpOnly Cookies&quot;">​</a></h1><p>I would like to talk about the SPA client authentication. Most of the blog implementations are stores the token into localStorage, sessionStorage or in-memory storage (redux/vuex/ngrx). It depends on your needs. For instance, you don&#39;t need high security with your In-House applications. For other cases, you need to increase your security. Today, I will try to explain that with my best.</p><blockquote><p>Rather than show all the implementations, the post will be clear and simple. You can find the source code at end of the post.</p></blockquote><h2 id="where-should-i-put-my-token-and-other-values" tabindex="-1">Where should I put my token and other values ? <a class="header-anchor" href="#where-should-i-put-my-token-and-other-values" aria-label="Permalink to &quot;Where should I put my token and other values ?&quot;">​</a></h2><p><img src="/img/cookie_monster.jpg" alt="The blog picture"></p><p>As I mentioned before, localStorage, sessionStorage and in-memory storages are candidates for this kind of questions. In web, also we have &quot;cookies&quot;. Best part of the cookies are you can manage them from server-side. For example, when a user logged in, you can put the user sensitive content into her/his cookies without handle it from client-side scripts.</p><p>Firstly, I would like show difference between handling other storages and cookies. The below code shows a simple comparison with <code>axios</code>.</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">async </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">loginRaw</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(username, password) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> axios.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;login&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    username,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    password</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (response.status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    sessionStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;token&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, token)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.history.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">async </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">loginCookie</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(username, password) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> axios.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;login&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    username,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    password</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (response.status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // the response already set the token into browser&#39;s cookie.</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.history.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Secondly, Let&#39;s give some details about the implementation. I will use three cookie property with login. Just focus on <code>X-Access-Token</code>.</p><div class="language-csharp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HttpPost</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;login&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Task</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IActionResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">LoginApi</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FromBody</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">LoginModel</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> model</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ModelState.IsValid)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> signIn</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _signInManager.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PasswordSignInAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(model.Username, model.Password, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (signIn.Succeeded)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _userManager.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FindByEmailAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(model.Username);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _jwtCreator.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Generate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(user.Email, user.Id);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            user.RefreshToken </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Guid.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NewGuid</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ToString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _userManager.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">UpdateAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(user);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            Response.Cookies.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;X-Access-Token&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, token, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CookieOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() { HttpOnly </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, SameSite </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SameSiteMode.Strict });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            Response.Cookies.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;X-Username&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, user.UserName, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CookieOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() { HttpOnly </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, SameSite </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SameSiteMode.Strict });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            Response.Cookies.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;X-Refresh-Token&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, user.RefreshToken, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CookieOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() { HttpOnly </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, SameSite </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SameSiteMode.Strict });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Ok</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        else</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BadRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { signIn.IsLockedOut, signIn.IsNotAllowed, signIn.RequiresTwoFactor });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    else</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BadRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ModelState);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>And finally, ASP.NET Core still waits the token from Authorization Header. Therefore, we have to set the token from the cookies. Startup.cs:</p><div class="language-csharp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">services.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddAuthentication</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ..</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddJwtBearer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        ..</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        options.Events.OnMessageReceived </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (context.Request.Cookies.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ContainsKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;X-Access-Token&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                context.Token </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> context.Request.Cookies[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;X-Access-Token&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Task.CompletedTask;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        };</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        ..</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span></code></pre></div><h3 id="httponly-and-samesite" tabindex="-1">HttpOnly and SameSite <a class="header-anchor" href="#httponly-and-samesite" aria-label="Permalink to &quot;HttpOnly and SameSite&quot;">​</a></h3><p>Only the cookies without HttpOnly flag are accessible from client-side script. Therefore, you just making things hard for the other people. Also, you will be avoided from <code>XSS</code> and <code>XSRF</code> attacks with <code>HttpOnly</code> and <code>SameSite=Strict</code> properties.</p><h2 id="how-should-i-send-the-token" tabindex="-1">How should I send the token ? <a class="header-anchor" href="#how-should-i-send-the-token" aria-label="Permalink to &quot;How should I send the token ?&quot;">​</a></h2><p>Other storages are accessible from the client-side hence you just write an interceptor and write the token into <code>Authorization</code> Header. After that the server-side handles the authentication.</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">axios.interceptors.request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">use</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sessionStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;token&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (auth </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> undefined</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> auth)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      request.headers.common[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Authorization&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;Bearer &#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> token;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p>As I mentioned above, after cookie with HttpOnly flag you couldn&#39;t access the token on client-side. <code>XMLHttpRequest</code> will access those cookies for us. Whenever there is a request the <code>XMLHttpRequest</code> sends all the cookies to the server-side.</p><blockquote><p>Note: If your Authentication Server is separated from your website. You can change the SameSite property on cookies. After that <code>XMLHttpRequest</code> or <code>Axios</code> with <code>withCredentials</code> property will do the work.</p></blockquote><h2 id="refresh-token" tabindex="-1">Refresh Token <a class="header-anchor" href="#refresh-token" aria-label="Permalink to &quot;Refresh Token&quot;">​</a></h2><p>JWT Token should have a short lifetime. In that case, you should empower your configurations with the refresh token. The definition as follows</p><blockquote><p>Refresh tokens are credentials used to obtain access tokens. Refresh tokens are issued to the client by the authorization server and are used to obtain a new access token when the current access token becomes invalid or expires, or to obtain additional access tokens with identical or narrower scope (access tokens may have a shorter lifetime and fewer permissions than authorized by the resource owner). (<a href="https://tools.ietf.org/html/rfc6749#section-1.5" target="_blank" rel="noreferrer">https://tools.ietf.org/html/rfc6749#section-1.5</a>)</p></blockquote><p>Once a refresh token is used then it should be disposed. Even if the refresh token is exposed it could be used only once. Then when the user login again the stolen refresh token will be invalid.</p><p>I will give an example about how you can handle the refresh token. You can call this endpoint from your client-side.</p><div class="language-csharp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HttpGet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;refresh&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Task</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IActionResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Refresh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Request.Cookies.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TryGetValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;X-Username&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">out</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> userName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Request.Cookies.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TryGetValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;X-Refresh-Token&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">out</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> refreshToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BadRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _userManager.Users.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FirstOrDefault</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i.UserName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> userName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i.RefreshToken </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> refreshToken);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BadRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _jwtCreator.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Generate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(user.Email, user.Id);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    user.RefreshToken </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Guid.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NewGuid</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ToString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _userManager.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">UpdateAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(user);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Response.Cookies.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;X-Access-Token&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, token, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CookieOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() { HttpOnly </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, SameSite </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SameSiteMode.Strict });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Response.Cookies.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;X-Username&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, user.UserName, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CookieOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() { HttpOnly </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, SameSite </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SameSiteMode.Strict });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Response.Cookies.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;X-Refresh-Token&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, user.RefreshToken, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CookieOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() { HttpOnly </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, SameSite </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SameSiteMode.Strict });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Ok</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="conclusion" tabindex="-1">Conclusion <a class="header-anchor" href="#conclusion" aria-label="Permalink to &quot;Conclusion&quot;">​</a></h2><p>Tokens are not completely safe, but we can increase the security with couple of measures. So cookies are a very well storage for the tokens. And, refresh token will prevent the user from re-login. You can reach the source code from <a href="https://github.com/alimozdemir/medium/tree/master/AuthJWTRefresh" target="_blank" rel="noreferrer">Github</a>.</p><p>Have a nice day !</p></div></div></main><footer class="VPDocFooter" data-v-07acbee8 data-v-6b8b697d><!--[--><!--]--><!----><!----></footer><!--[--><!--]--></div></div></div><!--[--><!--[--><!--[--><div class="container flex items-center justify-between mx-auto max-w-3xl w-full pb-8"><a class="VPButton big alt" href="/posts/aspnet-core-concatenating-json-endpoints" data-v-2bf5222a>Prev</a><a class="VPButton big alt" href="/posts/asp-net-core-a-powerful-api-design-with-odata-ef-and-sqlkata" data-v-2bf5222a>Next</a></div><!--]--><!--]--><!--]--></div></div><footer class="VPFooter" data-v-59c4430d data-v-929dc9cf><div class="container" data-v-929dc9cf><!----><p class="copyright" data-v-929dc9cf>Copyright © 2019-present Alim Özdemir</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"about.md\":\"DtwXcIKv\",\"index.md\":\"D-Y4UAdA\",\"page_1.md\":\"C9ooMqAK\",\"page_2.md\":\"B3xveMde\",\"page_3.md\":\"Dtry9oOv\",\"posts_asp-net-core-a-powerful-api-design-with-odata-ef-and-sqlkata.md\":\"CUKWBiwe\",\"posts_aspnet-core-concatenating-json-endpoints.md\":\"DY9misjc\",\"posts_aspnet-core-jwt-and-refresh-token-with-httponly-cookies.md\":\"BpEQeSYu\",\"posts_better-di-service-registration-with-assembly-scan.md\":\"L9cgB9Ew\",\"posts_deget-ddown-a-downloader-cli-api-for-dotnet.md\":\"yonjmOjl\",\"posts_deployment-of-signalr-with-nginx.md\":\"D9hDXOht\",\"posts_design-pattern-serisi-1-singleton.md\":\"DC00e0i1\",\"posts_design-pattern-serisi-2-object-pool.md\":\"CLQDFLw8\",\"posts_design-pattern-serisi-3-pipeline.md\":\"VP8SPtut\",\"posts_fabric-js-history-operations-undo-redo-and-useful-tips.md\":\"DnJ_saBK\",\"posts_hangfire-docker-with-multiple-servers.md\":\"CYXE1MfW\",\"posts_ml-net-kullanarak-coklu-dil-siniflandirma.md\":\"D2Qd73ZX\",\"posts_nuxt-3-casl-authorization.md\":\"m3_bd1wq\",\"posts_signalr-core-heartbeat-and-redis.md\":\"C3r4Zl7j\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Alim Özdemir\",\"description\":\"Alim Özdemir Personal Website\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://www.github.com/alimozdemir\"},{\"icon\":\"linkedin\",\"link\":\"https://www.linkedin.com/in/almozdmr/\"},{\"icon\":\"twitter\",\"link\":\"https://www.twitter.com/almozdmr\"}],\"footer\":{\"copyright\":\"Copyright © 2019-present Alim Özdemir\"},\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"About\",\"link\":\"/about\"}],\"search\":{\"provider\":\"local\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":true,\"contentProps\":{\"articlePerPage\":5}}");</script>
    
  </body>
</html>